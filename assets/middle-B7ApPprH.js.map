{"version":3,"file":"middle-B7ApPprH.js","sources":["../../src/api/cockpit/user.ts","../../src/views/login/middle.vue"],"sourcesContent":["import { ServicePrefixEnum } from '@/enums/comon';\nimport { RequestEnum } from '@/enums/httpEnum';\nimport Axios from '@/utils/http/axios/index';\n\nexport function getUserCurrentInfo() {\n  return Promise.resolve({\n    userInfo: {\n      userId: '349057407209541',\n      userAccount: 'admin',\n      userName: '管理员',\n      headIcon: '/api/file/Image/userAvatar/207.jpg',\n      organizeId: '17BEBDCB-248D-4668-B6CD-BF22A446BBD4',\n      organizeIdList: [\n        '96240625-934F-490B-8AA6-0BC775B18468',\n        '17BEBDCB-248D-4668-B6CD-BF22A446BBD4',\n      ],\n      organizeName: '海宁市/镇海康养院',\n      positionIds: [],\n      systemIds: [\n        {\n          id: '423160212987973',\n          name: '业务平台',\n          icon: 'icon-ym icon-ym-signature',\n          currentSystem: false,\n        },\n        {\n          id: '309228585019769285',\n          name: '开发平台',\n          icon: 'icon-ym icon-ym-signature',\n          currentSystem: true,\n        },\n      ],\n      positionId: '',\n      positionName: '',\n      prevLogin: 0,\n      prevLoginTime: 1724145080000,\n      prevLoginIPAddress: '127.0.0.1',\n      prevLoginIPAddressName: '本地连接',\n      portalId: '',\n      appPortalId: '549973121055064389',\n      roleIds: [],\n      roleName: null,\n      roleEncode: null,\n      manager: null,\n      mobilePhone: '18588888888',\n      email: '323',\n      birthday: null,\n      departmentId: '17BEBDCB-248D-4668-B6CD-BF22A446BBD4',\n      departmentName: '镇海康养院',\n      isAdministrator: true,\n      signImg: '',\n      changePasswordDate: 1602731493000,\n      systemId: '309228585019769285',\n      appSystemId: null,\n      groupIds: [],\n      groupNames: [],\n      workflowEnabled: 1,\n    },\n  });\n  // return Axios({\n  //   url: ServicePrefixEnum.OAUTH + '/CurrentUser',\n  //   method: RequestEnum.GET,\n  // });\n}\n\nexport function login(data: any) {\n  return Axios({\n    url: ServicePrefixEnum.OAUTH + '/login',\n    method: RequestEnum.POST,\n    data,\n  });\n}\n","<script setup lang=\"ts\">\n  import { getUserCurrentInfo } from '@/api/cockpit/user';\n  import { useMessage } from '@/hooks/useMessage';\n  import { useLoadingStore } from '@/stores/loading';\n  import { setToken, setUserInfo } from '@/utils';\n  import { loginOut } from '@/utils/http/axios/utils';\n\n  const route = useRoute();\n  const router = useRouter();\n  const { startLoading, endLoading } = useLoadingStore();\n  const { createMessage, notification } = useMessage();\n  const { orgId, name } = route.query;\n  const token = 'test';\n  startLoading();\n  if (!token) {\n    if (import.meta.env.DEV) {\n      createMessage.warn('请先登录');\n    } else {\n      loginOut('请先登录');\n    }\n  } else {\n    setToken(token as string);\n    // 获取用户信息\n    // 这里走免登接口\n    getUserCurrentInfo().then((res: any) => {\n      setUserInfo(res);\n      // createMessage.success('登录成功');\n      notification.success({\n        message: '登录成功',\n        description: '欢迎回来，' + res?.userInfo?.userName + '！',\n        duration: 4,\n      });\n      // 跳转页面\n      setTimeout(() => {\n        endLoading();\n        if (orgId) {\n          router.replace({\n            path: '/institution',\n            query: {\n              orgId,\n              name,\n            },\n          });\n        } else {\n          router.replace('/');\n        }\n      }, 2000);\n    });\n  }\n</script>\n<template>\n  <PageWrapper :show-header=\"false\">\n    <Loading class=\"loading\" :content=\"'登录中...'\" />\n  </PageWrapper>\n</template>\n\n<style scoped lang=\"scss\">\n  @import '@/styles/common.scss';\n</style>\n"],"names":["getUserCurrentInfo","token","route","useRoute","router","useRouter","startLoading","endLoading","useLoadingStore","notification","useMessage","orgId","name","setToken","res","setUserInfo","_withCtx","_createVNode","_component_Loading"],"mappings":"0NAIO,SAASA,GAAqB,CACnC,OAAO,QAAQ,QAAQ,CACrB,SAAU,CACR,OAAQ,kBACR,YAAa,QACb,SAAU,MACV,SAAU,qCACV,WAAY,uCACZ,eAAgB,CACd,uCACA,sCAAA,EAEF,aAAc,YACd,YAAa,CAAA,EACb,UAAW,CACT,CACE,GAAI,kBACJ,KAAM,OACN,KAAM,4BACN,cAAe,EAAA,EAEjB,CACE,GAAI,qBACJ,KAAM,OACN,KAAM,4BACN,cAAe,EAAA,CACjB,EAEF,WAAY,GACZ,aAAc,GACd,UAAW,EACX,cAAe,YACf,mBAAoB,YACpB,uBAAwB,OACxB,SAAU,GACV,YAAa,qBACb,QAAS,CAAA,EACT,SAAU,KACV,WAAY,KACZ,QAAS,KACT,YAAa,cACb,MAAO,MACP,SAAU,KACV,aAAc,uCACd,eAAgB,QAChB,gBAAiB,GACjB,QAAS,GACT,mBAAoB,aACpB,SAAU,qBACV,YAAa,KACb,SAAU,CAAA,EACV,WAAY,CAAA,EACZ,gBAAiB,CAAA,CACnB,CACD,CAKH,CCnDE,MAAAC,EAAA,qCALA,MAAAC,EAAAC,EAAA,EACAC,EAAAC,EAAA,EACA,CAAA,aAAAC,EAAA,WAAAC,CAAA,EAAAC,EAAA,EACA,CAAA,aAAAC,CAAA,EAAAC,EAAA,EACA,CAAA,MAAAC,EAAA,KAAAC,CAAA,EAAAV,EAAA,MAEA,OAAAI,EAAA,EAQEO,EAAAZ,CAAA,EAGAD,EAAA,EAAA,KAAAc,GAAA,CACEC,EAAAD,CAAA,EAEAL,EAAA,QAAA,CAAqB,QAAA,OACV,YAAA,QAAAK,GAAA,UAAA,SAAA,IACwC,SAAA,CACvC,CAAA,EAGZ,WAAA,IAAA,CACEP,EAAA,EACAI,EACEP,EAAA,QAAA,CAAe,KAAA,eACP,MAAA,CACC,MAAAO,EACL,KAAAC,CACA,CACF,CAAA,EAGFR,EAAA,QAAA,GAAA,CACF,EAAA,GAAA,CACK,CAAA,2DAKqB,QAAAY,EAAA,IAAA,CACiBC,EAAAC,EAAA,CAAA,MAAA,UAAhC,QAAA,QAAoB,CAAA"}